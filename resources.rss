<?php
/*******************************************************************************
 * Copyright (c) 2006 Eclipse Foundation and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Wayne Beaton (Eclipse Foundation)- initial API and implementation
 *******************************************************************************/

	#*****************************************************************************
	#
	# articles.rss
	#
	# Author: 		Wayne Beaton
	# Date:			2006-07-18
	#
	# Description: This page generates an RSS feed containing resources. 
	#   Optional filter parameters can be provided (see scripts/filter_core.php
    #   for information) to prune the list.
	#****************************************************************************
	header('Content-type: text/xml');
	
	// The next line needs to occur first in the file.
	echo "<?xml version=\"1.0\"?>\n";
	echo "<!DOCTYPE doc [";
	echo "<!ENTITY trade \"TM\">\n";
	echo "]>";
	
	require_once("scripts/resources_mgr.php");
	require_once("scripts/filter_core.php");
	
	$filter = new Filter();	
	$filter->populate_from_html_request_header();
	$filter_summary = $filter->get_summary();
	$filter_string = $filter->get_url_parameters();	
	if ($filter_string) $filter_string = '?'.$filter_string;
	$resources = $Resources->get_resources($filter);
	$host = $_SERVER['HTTP_HOST'];
	$resources_root = "http://$host/resources";
	
	echo <<<EORSS
<rss version="2.0">
  <channel>
    <title>Eclipse Resources</title>
    <description>$filter_summary</description>
    <link><![CDATA[$resources_root$filter_string]]></link>
    <image>
      <url>$resources_root/images/eclipse.png</url>
      <title>eclipse.org</title>
      <link>$resources_root</link>
    </image>
EORSS;
	foreach ($resources as $resource) {
		if (!$filter->show_resource($resource)) continue;
		echo "\n\t<item>";
		echo "\n\t\t<title><![CDATA[$resource->title]]></title>";
		echo "\n\t\t<link>$resources_root/resource.php?id=$resource->id</link>";
		echo "\n\t\t<description><![CDATA[$resource->description]]></description>";
		$date = date("D, j M Y  12:00:00 \G\M\T", $resource->get_date());
		echo "\n\t\t<pubDate>$date</pubDate>";
		echo "\n\t</item>";
	}
	
	echo <<<EORSS
	</channel>
</rss>
EORSS;
?>
